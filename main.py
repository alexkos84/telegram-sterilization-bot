import os
import telebot
from telebot import types
from flask import Flask, request
from datetime import datetime
import time

TOKEN = os.environ.get('TOKEN')
if not TOKEN:
    print("âŒ ĞÑˆĞ¸Ğ±ĞºĞ°: ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ TOKEN Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°!")
    exit(1)

PORT = int(os.environ.get('PORT', 8080))
WEBHOOK_URL = os.environ.get('RAILWAY_STATIC_URL')  # ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ½Ğ° Railway

bot = telebot.TeleBot(TOKEN)
app = Flask(__name__)

paid_text = (
    "ğŸ’°âœ¨ <b>ĞŸĞ›ĞĞ¢ĞĞĞ¯ Ğ¡Ğ¢Ğ•Ğ Ğ˜Ğ›Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯</b> âœ¨ğŸ’°\n\n"
    "ğŸ“‹ <b>Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼ ÑƒÑ‚Ğ¾Ñ‡Ğ½ÑÑ‚ÑŒ Ñ†ĞµĞ½Ñ‹ Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸</b>\n"
    "ğŸ•’ <b>Ğ ĞµĞ¶Ğ¸Ğ¼ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ñ€Ğ°Ğ·Ğ»Ğ¸Ñ‡Ğ°Ñ‚ÑŒÑÑ</b>\n"
    "ğŸ’™ <b>Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑƒĞ´Ğ¾Ğ±Ğ½ÑƒÑ Ğ´Ğ»Ñ Ğ²Ğ°Ñ ĞºĞ»Ğ¸Ğ½Ğ¸ĞºÑƒ!</b>\n\n"

    "ğŸ¾ <b>Ğ•Ğ²Ğ³ĞµĞ½Ğ¸Ñ ĞšĞ¾Ğ½Ğ¾Ğ½ĞµĞ½ĞºĞ¾</b>\n"
    "ğŸ“ <a href='https://yandex.ru/maps/?text=Ğ¯Ğ»Ñ‚Ğ°+ÑƒĞ».+Ğ˜Ğ·Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ğ°Ñ+20'>ÑƒĞ». Ğ˜Ğ·Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ğ°Ñ, 20</a>\n"
    "ğŸ“ +79789885105\n"
    "ğŸ’µ <b>Ğ¡Ñ‚ĞµÑ€Ğ¸Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚ 2000â‚½</b>\n\n"

    "ğŸ¾ <b>Ğ¤Ğ°ÑƒĞ½Ğ°</b>\n"
    "ğŸ“ <a href='https://yandex.ru/maps/?text=Ğ¯Ğ»Ñ‚Ğ°+ÑƒĞ».+Ğ˜Ğ·Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ğ°Ñ+20'>ÑƒĞ». Ğ˜Ğ·Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ğ°Ñ, 20</a>\n"
    "ğŸ“ +79789885105\n"
    "ğŸ’µ <b>Ğ¡Ñ‚ĞµÑ€Ğ¸Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚ 2300â‚½</b>\n\n"

    "ğŸ¾ <b>Ğ”Ğ¾ĞºÑ‚Ğ¾Ñ€ Ğ›ÑƒĞºÑŒÑĞ½Ğ¾Ğ²</b>\n"
    "ğŸ“ <a href='https://yandex.ru/maps/?text=Ğ¯Ğ»Ñ‚Ğ°+ÑƒĞ».+Ğ“Ğ¾Ğ³Ğ¾Ğ»Ñ+16'>ÑƒĞ». Ğ“Ğ¾Ğ³Ğ¾Ğ»Ñ, 16</a>\n"
    "ğŸ“ +79788789309\n"
    "ğŸ’µ <b>Ğ¡Ñ‚ĞµÑ€Ğ¸Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ĞºĞ¾ÑˆĞºĞ¸ 4500â‚½</b>\n"
    "ğŸ’µ <b>ĞšĞ°ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ ĞºĞ¾Ñ‚Ğ° 3500â‚½</b>\n\n"

    "ğŸ¾ <b>Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ĞµĞ¹ĞšĞ¾</b>\n"
    "ğŸ“ <a href='https://yandex.ru/maps/?text=Ğ¯Ğ»Ñ‚Ğ°+ÑƒĞ».+ĞšÑ€Ğ°ÑĞ½Ğ¾Ğ°Ñ€Ğ¼ĞµĞ¹ÑĞºĞ°Ñ+6'>ÑƒĞ». ĞšÑ€Ğ°ÑĞ½Ğ¾Ğ°Ñ€Ğ¼ĞµĞ¹ÑĞºĞ°Ñ, 6</a>\n"
    "ğŸ“ +79787824682\n"
    "ğŸ’µ <b>Ğ¡Ñ‚ĞµÑ€Ğ¸Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ĞºĞ¾ÑˆĞºĞ¸ 3500â‚½</b>\n"
    "ğŸ’µ <b>ĞšĞ°ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ ĞºĞ¾Ñ‚Ğ° 2500â‚½</b>\n\n"

    "ğŸ¾ <b>Ğ®Ğ»Ğ¸Ñ Ğ¢ĞµÑ€ĞµÑ‰ÑƒĞº</b>\n"
    "ğŸ“ <a href='https://yandex.ru/maps/?text=Ğ¯Ğ»Ñ‚Ğ°+ÑƒĞ».+ĞœĞ¾ÑĞºĞ¾Ğ²ÑĞºĞ°Ñ+31'>ÑƒĞ». ĞœĞ¾ÑĞºĞ¾Ğ²ÑĞºĞ°Ñ, 31</a>\n"
    "ğŸ“ +79782906405\n"
    "ğŸ’µ <b>Ğ¡Ñ‚ĞµÑ€Ğ¸Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚ 3000â‚½</b>\n\n"

    "ğŸ¾ <b>ĞĞ¹Ğ±Ğ¾Ğ»Ğ¸Ñ‚</b>\n"
    "ğŸ“ <a href='https://yandex.ru/maps/?text=Ğ¯Ğ»Ñ‚Ğ°+ÑƒĞ».+Ğ’Ğ°ÑĞ¸Ğ»ÑŒĞµĞ²Ğ°+7'>ÑƒĞ». Ğ’Ğ°ÑĞ¸Ğ»ÑŒĞµĞ²Ğ°, 7</a>\n"
    "ğŸ“ +79788697009\n"
    "ğŸ’µ <b>Ğ¡Ñ‚ĞµÑ€Ğ¸Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚ 1800â‚½</b>\n\n"

    "ğŸ¾ <b>Ğ¯Ğ»Ñ‚Ğ¸Ğ½ÑĞºĞ¸Ğ¹ Ğ²ĞµÑ‚ĞµÑ€Ğ¸Ğ½Ğ°Ñ€Ğ½Ñ‹Ğ¹ Ğ³Ğ¾ÑĞ¿Ğ¸Ñ‚Ğ°Ğ»ÑŒ</b>\n"
    "ğŸ“ <a href='https://yandex.ru/maps/?text=Ğ¯Ğ»Ñ‚Ğ°+ÑƒĞ».+Ğ¢Ğ¸Ğ¼Ğ¸Ñ€ÑĞ·ĞµĞ²Ğ°+33'>ÑƒĞ». Ğ¢Ğ¸Ğ¼Ğ¸Ñ€ÑĞ·ĞµĞ²Ğ°, 33</a>\n"
    "ğŸ“ +79787116762\n"
    "ğŸ’µ <b>Ğ¡Ñ‚ĞµÑ€Ğ¸Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚ 2000â‚½</b>\n\n"

    "ğŸ¾ <b>Ğ”Ğ¾Ğ²ĞµÑ€Ğ¸Ğµ</b>\n"
    "ğŸ“ <a href='https://yandex.ru/maps/?text=Ğ¯Ğ»Ñ‚Ğ°+ÑƒĞ».+Ğ¥Ğ°Ğ»Ñ‚ÑƒÑ€Ğ¸Ğ½Ğ°+52Ğ'>ÑƒĞ». Ğ¥Ğ°Ğ»Ñ‚ÑƒÑ€Ğ¸Ğ½Ğ°, 52Ğ</a>\n"
    "ğŸ“ +79782561501\n"
    "ğŸ’¬ <i>Ğ¦ĞµĞ½Ğ° ÑƒÑ‚Ğ¾Ñ‡Ğ½ÑĞµÑ‚ÑÑ</i>\n\n"

    "ğŸ¾ <b>Ğ“Ğ‘Ğ£ Ğ’Ğ›ĞŸĞ¦</b>\n"
    "ğŸ“ <a href='https://yandex.ru/maps/?text=Ğ¯Ğ»Ñ‚Ğ°+ÑƒĞ».+Ğ¡Ğ¾Ñ…Ğ°Ğ½Ñ+5'>ÑƒĞ». Ğ¡Ğ¾Ñ…Ğ°Ğ½Ñ, 5</a>\n"
    "ğŸ“ +79788603698\n"
    "ğŸ’¬ <i>Ğ¦ĞµĞ½Ğ° ÑƒÑ‚Ğ¾Ñ‡Ğ½ÑĞµÑ‚ÑÑ</i>\n\n"
)

free_text = (
    "ğŸ‰ <b>Ğ‘Ğ•Ğ¡ĞŸĞ›ĞĞ¢ĞĞĞ¯ Ğ¡Ğ¢Ğ•Ğ Ğ˜Ğ›Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯</b> ğŸ‰\n"
    "ğŸˆâ€â¬› <b>Ğ´Ğ»Ñ Ğ±ĞµĞ·Ğ´Ğ¾Ğ¼Ğ½Ñ‹Ñ… ĞºĞ¾ÑˆĞµĞº.</b> ğŸˆâ€â¬›\n"
    "ğŸ¥ <b>Ğ’ ĞºĞ»Ğ¸Ğ½Ğ¸ĞºĞµ Â«ĞĞ¹Ğ±Ğ¾Ğ»Ğ¸Ñ‚Â»</b>\n"
    "ğŸ“ <a href='https://yandex.ru/maps/-/CHXZj0jJ'>Ğ³. Ğ¯Ğ»Ñ‚Ğ°, ÑƒĞ». Ğ’Ğ°ÑĞ¸Ğ»ÑŒĞµĞ²Ğ°, 7</a>\n"
    "<b>âš ï¸ Ğ—ĞĞŸĞ˜Ğ¡Ğ¬ ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ!</b>\n\n"
    "â¿â¿â¿â¿â¿â¿â¿â¿â¿â¿â¿\n\n"
    "â€¼ï¸ <b>Ğ—Ğ²Ğ¾Ğ½Ğ¸Ñ‚Ğµ Ğ·Ğ° 2â€“3 Ğ´Ğ½Ñ Ğ´Ğ¾ Ğ¾Ñ‚Ğ»Ğ¾Ğ²Ğ°:</b>\n"
    "â° <b>Ğ’Ñ€ĞµĞ¼Ñ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ° Ğ·Ğ°ÑĞ²Ğ¾Ğº: 8:00 â€” 9:00</b>\n"
    "<i>(Ğ²ÑĞµ Ğ´Ğ½Ğ¸, ĞºÑ€Ğ¾Ğ¼Ğµ Ñ‡ĞµÑ‚Ğ²ĞµÑ€Ğ³Ğ°)</i>\n"
    "ğŸ“ +79781449070 <b>(Ğ•ĞºĞ°Ñ‚ĞµÑ€Ğ¸Ğ½Ğ°)</b>\n\n"
    "â¿â¿â¿â¿â¿â¿â¿â¿â¿â¿â¿\n\n"
    "âš ï¸ <b>Ğ’ĞĞ–ĞĞ«Ğ• Ğ¢Ğ Ğ•Ğ‘ĞĞ’ĞĞĞ˜Ğ¯:</b>\n\n"
    "â€¼ï¸ <b>Ğ¡ Ğ’Ğ°Ñ Ğ¾Ñ‚Ğ»Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¸ Ğ¿Ñ€Ğ¸Ğ²ĞµĞ·Ñ‚Ğ¸ ĞºĞ¾ÑˆĞºÑƒ Ğ² ĞºĞ»Ğ¸Ğ½Ğ¸ĞºÑƒ</b>\n"
    "ğŸ”¸ <b>ĞŸĞµÑ€ĞµĞ´ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸ĞµĞ¹:</b> <u>ĞĞ• ĞºĞ¾Ñ€Ğ¼Ğ¸Ñ‚Ğµ ĞºĞ¾ÑˆĞºÑƒ</u>\n"    
    "ğŸ”¸ <b>ĞŸĞµÑ€ĞµĞ½Ğ¾ÑĞºĞ°:</b> Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ»Ğ°ÑÑ‚Ğ¸ĞºĞ¾Ğ²Ğ°Ñ Ğ¸ Ğ¿Ñ€Ğ¾Ñ‡Ğ½Ğ°Ñ\n"
    "   <i>(Ğ¿Ñ€Ğ¸ ÑĞ¾Ğ¼Ğ½ĞµĞ½Ğ¸ÑÑ… â€” Ğ¿ĞµÑ€ĞµĞ¼Ğ¾Ñ‚Ğ°Ğ¹Ñ‚Ğµ ÑĞºĞ¾Ñ‚Ñ‡ĞµĞ¼!)</i>\n"
    "ğŸ”¸ <b>Ğ’Ğ½ÑƒÑ‚Ñ€Ğ¸:</b> Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ¿Ğ¾Ğ»Ğ¾Ğ¶Ğ¸Ñ‚Ğµ Ğ¿ĞµĞ»Ñ‘Ğ½ĞºÑƒ\n"
    "ğŸ”¸ <b>ĞĞ° Ğ¿ĞµÑ€ĞµĞ½Ğ¾ÑĞºÑƒ:</b> Ğ¿Ñ€Ğ¸ĞºĞ»ĞµĞ¹Ñ‚Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞºÑƒ Ñ Ğ°Ğ´Ñ€ĞµÑĞ¾Ğ¼\n"
    "   Ğ¸ Ğ²Ğ°ÑˆĞ¸Ğ¼ Ğ½Ğ¾Ğ¼ĞµÑ€Ğ¾Ğ¼ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ°\n"
    "ğŸ— <b>ĞœĞ¾Ğ¶ĞµÑ‚Ğµ Ğ¿Ğ¾Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ÑŒ Ğ¼ÑĞ³ĞºĞ¸Ğ¹ ĞºĞ¾Ñ€Ğ¼ Ğ² Ğ¿Ğ°ĞºĞµÑ‚Ğ¸ĞºĞ°Ñ…</b>\n"
    "ğŸš« <b><u>Ğ¢ĞºĞ°Ğ½ĞµĞ²Ñ‹Ğµ Ğ¿ĞµÑ€ĞµĞ½Ğ¾ÑĞºĞ¸ Ğ¸ ÑÑƒĞ¼ĞºĞ¸ Ğ—ĞĞŸĞ Ğ•Ğ©Ğ•ĞĞ«!</u></b>\n\n"
    "â¿â¿â¿â¿â¿â¿â¿â¿â¿â¿â¿\n\n"
    "ğŸ›¡ï¸ <b>ĞŸĞĞ¡Ğ›Ğ• Ğ¡Ğ¢Ğ•Ğ Ğ˜Ğ›Ğ˜Ğ—ĞĞ¦Ğ˜Ğ˜:</b>\n\n"
    "âœ… <b>ĞšĞ¾ÑˆĞºÑƒ Ğ·Ğ°Ğ±Ğ¸Ñ€Ğ°ÑÑ‚ Ğ½Ğ°ÑˆĞ¸ Ğ²Ğ¾Ğ»Ğ¾Ğ½Ñ‚Ñ‘Ñ€Ñ‹</b>\n"
    "âœ… <b>ĞŸĞµÑ€ĞµĞ´ĞµÑ€Ğ¶ĞºĞ° 1â€“2 Ğ´Ğ½Ñ Ğ´Ğ»Ñ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ</b>\n"
    "âœ… <b>Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ Ğ¿Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğ¼Ñƒ Ğ’Ğ°Ğ¼Ğ¸ Ğ°Ğ´Ñ€ĞµÑÑƒ</b>\n\n"
    "â¿â¿â¿â¿â¿â¿â¿â¿â¿â¿â¿\n\n"
    "ğŸ“¢ <b>Ğ”Ğ Ğ£Ğ—Ğ¬Ğ¯, ĞĞ• Ğ£ĞŸĞ£Ğ¡Ğ¢Ğ˜Ğ¢Ğ• Ğ¨ĞĞĞ¡!</b>\n\n"
    "ğŸ¾ <b>ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¼ĞµÑÑ‚ ĞĞ“Ğ ĞĞĞ˜Ğ§Ğ•ĞĞ</b>\n"
    "â˜ï¸ <b>Ğ—Ğ²Ğ¾Ğ½Ğ¸Ñ‚Ğµ Ğ¸ Ğ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ğ¹Ñ‚ĞµÑÑŒ Ğ¿Ñ€ÑĞ¼Ğ¾ ÑĞµĞ¹Ñ‡Ğ°Ñ!</b>\n\n"
    "ğŸ’™ğŸ± <b><i>Ğ’Ğ¼ĞµÑÑ‚Ğµ Ğ¼Ñ‹ Ğ´ĞµĞ»Ğ°ĞµĞ¼ Ğ¼Ğ¸Ñ€ Ğ´Ğ¾Ğ±Ñ€ĞµĞµ!</i></b> ğŸ±ğŸ’™"
)

# Webhook Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº
@app.route(f'/{TOKEN}', methods=['POST'])
def webhook():
    if request.headers.get('content-type') == 'application/json':
        json_string = request.get_data().decode('utf-8')
        update = telebot.types.Update.de_json(json_string)
        bot.process_new_updates([update])
        return ''
    return 'Bad request', 403

@app.route('/')
def home():
    return f"ğŸ¤– Bot is running! Time: {datetime.now().strftime('%H:%M:%S')}"

@app.route('/health')
def health():
    return {"status": "ok", "time": datetime.now().isoformat()}

@bot.message_handler(commands=['start'])
def start(message):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    markup.add("ğŸ’° ĞŸĞ»Ğ°Ñ‚Ğ½Ğ°Ñ", "ğŸ†“ Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ°Ñ")
    bot.send_message(message.chat.id, "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ‚Ğ¸Ğ¿ ÑÑ‚ĞµÑ€Ğ¸Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸:", reply_markup=markup)

@bot.message_handler(commands=['status'])
def status(message):
    current_time = datetime.now().strftime('%d.%m.%Y %H:%M:%S')
    bot.send_message(message.chat.id, f"ğŸ¤– Ğ‘Ğ¾Ñ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚!\nâ° Ğ’Ñ€ĞµĞ¼Ñ: {current_time}")

@bot.message_handler(func=lambda message: True)
def handle_buttons(message):
    if message.text == "ğŸ’° ĞŸĞ»Ğ°Ñ‚Ğ½Ğ°Ñ":
        bot.send_message(message.chat.id, paid_text, parse_mode="HTML", disable_web_page_preview=True)
    elif message.text == "ğŸ†“ Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ°Ñ":
        bot.send_message(message.chat.id, free_text, parse_mode="HTML", disable_web_page_preview=True)
    else:
        markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
        markup.add("ğŸ’° ĞŸĞ»Ğ°Ñ‚Ğ½Ğ°Ñ", "ğŸ†“ Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ°Ñ")
        bot.send_message(message.chat.id, "ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ¾Ğ´Ğ½Ñƒ Ğ¸Ğ· ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº Ğ½Ğ¸Ğ¶Ğµ:", reply_markup=markup)

def setup_webhook():
    try:
        bot.remove_webhook()
        time.sleep(1)
        bot.set_webhook(url=f"https://{WEBHOOK_URL}/{TOKEN}")
        print(f"âœ… Webhook ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½: https://{WEBHOOK_URL}/{TOKEN}")
    except Exception as e:
        print(f"âŒ ĞÑˆĞ¸Ğ±ĞºĞ° webhook: {e}")

if __name__ == "__main__":
    setup_webhook()
    app.run(host='0.0.0.0', port=PORT)

